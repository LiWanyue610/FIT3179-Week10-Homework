<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analysis of Malaysia's Permanent Forest Cover</title>

  <!-- Vega libraries (Vega 5 + Vega-Lite 6 + Vega-Embed 6) -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    :root {
      --bg: #ebf6f9;
      --card: #e5feeb;
      --muted: #3c7250;
      --text: #07352b;
      --accent: #1e9c33;
      --accent-2: #32434d;
      --border: rgba(255,255,255,0.12);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --keypoints: #639976;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 70% -10%, rgba(63,139,255,0.15), transparent) ,
                  radial-gradient(900px 500px at 10% 120%, rgba(0,255,204,0.08), transparent),
                  var(--bg);
      font-family:  "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
    }
    .wrap {
      max-width: 1080px;
      margin: 48px auto 80px;
      padding: 0 20px;
    }
    header {
      text-align: center;
      margin-bottom: 28px;
    }
    .eyebrow {
      display: inline-block;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: .08em;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 14px;
      background: rgba(255,255,255,0.03);
    }
    h1 {
      font-size: clamp(26px, 4vw, 40px);
      line-height: 1.15;
      margin: 0 0 6px 0;
      letter-spacing: 0.2px;
    }
    .subtitle {
      color: var(--muted);
      font-size: clamp(14px, 2.1vw, 18px);
      margin-bottom: 8px;
    }
    .author {
      color: var(--muted);
      font-size: 13px;
      letter-spacing: .02em;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
      margin: 22px 0 34px;
    }
    .card__head {
      padding: 18px 20px 0;
    }
    .kicker {
      font-weight: 600;
      font-size: 13px;
      color: var(--accent);
      letter-spacing: .05em;
      text-transform: uppercase;
    }
    h2 {
      margin: 6px 0 10px;
      font-size: clamp(18px, 2.6vw, 24px);
    }
    .desc {
      color: var(--muted);
      margin: 0 0 14px;
      font-size: 15px;
    }
    .viz {
      padding: 6px 10px 2px;
      background: radial-gradient(400px 200px at 10% 0%, rgba(123,211,137,0.06), transparent);
    }
    .caption {
      padding: 2px 20px 18px;
      color: var(--muted);
      font-size: 14px;
      border-top: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
    }
    .keypoints {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin: 12px 0 0;
      padding: 0;
      list-style: none;
      background: var(--keypoints);
      border: 1px solid var(--border);
      border-radius: 16px;
      color:rgb(240, 255, 253);
    }
    .chip {
      border: 1px dashed var(--border);
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(255,255,255,0.02);
      font-size: 13.5px;
    }
    footer {
      margin-top: 44px;
      padding-top: 18px;
      border-top: 1px dashed var(--border);
      color: var(--muted);
      font-size: 13.5px;
    }
    code.inline {
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      padding: 2px 6px;
      border-radius: 6px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
      color: #e3f2ff;
    }
    .sr-only { position: absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="eyebrow">Analysis of Malaysia's Permanent Forest Coverage</div>
      <h1>Analysis of Malaysia's Permanent Forest Coverage</h1>
      <p class="subtitle">Visualisation of Permanent Forest Cover Proportion Across Malaysian States</p>
      <p class="author">Author: Li Wanyue</p>
    </header>


    <section class="card" aria-labelledby="map-title">
      <div class="card__head">
        <div class="kicker">Choropleth Map (2021)</div>
        <h2 id="map-title">Malaysian State Permanent Forest Coverage in 2021</h2>
        <p class="desc">
          This choropleth map depicts state boundaries against a backdrop of a graticule and oceanic base colour, 
          with areas shaded according to permanent forest cover percentage. Hovering the mouse reveals state names and specific coverage.
        </p>
      </div>
      <div class="viz">
        <div id="viz-map" role="img" aria-label="2021 Choropleth Map of Permanent Forest Cover by State in Malaysia"></div>
      </div>
      <div class="caption">
        <strong>Key Points:</strong>
        <ul class="keypoints">
          <li class="chip">Deeper grean means higher forest coverage; The gaps are 10%, 20%, 30%, 40%, 50%, 60%.</li>
          <li class="chip">Regional differences: Forest cover in Sabah and Sarawak is generally higher than in western Malaysia. 
            The state with the highest forest cover in the west is Melaka (which also holds the highest forest cover across the whole of Malaysia).</li>
          <li class="chip">Protection effectiveness: Several states maintain forest cover exceeding 40%, demonstrating effective conservation measures.</li>
        </ul>
      </div>
    </section>


    <section class="card" aria-labelledby="iso-title">
      <div class="card__head">
        <div class="kicker">Isotype (2003 - 2021)</div>
        <h2 id="iso-title">Forest cover rates for each state represented by emojisðŸŒ³ (with year slider)</h2>
        <p class="desc">
          Presented using isotype: each tree represents approximately 10% of permanent forest cover. 
          Drag the slider to view a year-on-year comparison for any year between 2003 and 2021.
        </p>
      </div>
      <div class="viz">
        <div id="viz-iso" role="img" aria-label="Interactive isotype maps of forest coverage by state, 2003 to 2021"></div>
      </div>
      <div class="caption">
        <strong>Key Points:</strong>
        <ul class="keypoints">
          <li class="chip">The number of trees directly corresponds to the coverage rate (one tree per 10%, rounded up).</li>
          <li class="chip">The data for Sarawak in 2010 and 2011 were not available (NA), so the mean value for Sarawak across the 
            entire time period was used to impute the missing values during dataset cleaning.</li>
          <li class="chip">Use the slider to select a year, enabling cross-year comparisons and trend analysis.</li>
        </ul>
      </div>
    </section>

    <footer>
      <strong>Data Source: </strong>
      <p>Author: OpenDOSM (Department of National Statistics, Malaysia)</p>
      <p>Link: 
        <a href = "https://open.dosm.gov.my/data-catalogue/forest_reserve_state">
        Click here to view the source website.
      </a></p>
        <p>Information: Permanent Forest Reserve Areas by State - Year-end permanent forest reserve areas by state. Data as of 2021.</p>
    </footer>
  </div>

  <script>
    const specMap = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Choropleth of Malaysia states - permanent forest area percentage (2021). Ocean = blue, graticule included.",
      "width": 700,
      "height": 400,
      "background": "#cfeeff",
      "layer": [
        {
          "name": "graticule",
          "data": {"graticule":  {
          "step": [5, 5]
          }
        },
          "mark": {
            "type": "geoshape",
            "stroke": "#b8d0e6",
            "strokeWidth": 0.6,
            "fill": null
          },
          "projection": {"type": "mercator", "center": [109, 4], "scale": 1200}
        },
        {
          "name": "states",
          "data": {
            "url": "https://raw.githubusercontent.com/LiWanyue610/FIT3179-Week9-Homework/refs/heads/main/malaysia-states.topojson",
            "format": {"type": "topojson", "feature": "states"}
          },
          "transform": [
            {
              "lookup": "properties.Name",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/LiWanyue610/FIT3179-Week9-Homework/refs/heads/main/cleaned_forest_reserve_state.csv",
                  "format": {"type": "csv"}
                },
                "key": "name",
                "fields": ["forest_cover_rate_percentage"]
              }
            }
          ],
          "mark": {
            "type": "geoshape",
            "stroke": "#666666",
            "strokeWidth": 0.6
          },
          "encoding": {
            "color": {
              "field": "forest_cover_rate_percentage",
              "type": "quantitative",
              "title": "Permanent Forest Coverage (%)",
              "scale": {
                "type": "threshold",
                "domain": [10, 20, 30, 40, 50, 60],
                "range": ["#EBFAEA", "#A3EA9F", "#5AD954", "#2CAB26", "#23861D", "#196015", "#051505"]
              },
              "legend": {
                "orient": "right",
                "titleLimit": 200,
                "symbolType": "square"
              }
            },
            "tooltip": [
              {"field": "properties.Name", "type": "nominal", "title": "State"},
              {"field": "forest_cover_rate_percentage", "type": "quantitative", "title": "Forest Coverage (%)", "format": ".1f"}
            ]
          },
          "projection": {"type": "mercator", "center": [109, 4], "scale": 1200}
        }
      ],
      "config": {
        "view": {"stroke": "transparent"},
        "axis": {"domain": false}
      }
    };

    const specIso = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.1.0.json",
      "description": "Isotype-style: ðŸŒ³ per 10% forest cover (capped at 7 = 70%). Slider selects year 2003â€“2021. Increased horizontal spacing for emojis.",
      "data": {
        "url": "https://raw.githubusercontent.com/LiWanyue610/FIT3179-Visualisation-2/refs/heads/main/forest_coerage_clean.csv",
        "format": {"type": "csv"}
      },
      "params": [
        {
          "name": "Choose_Year",
          "value": 2003,
          "bind": {"input": "range", "min": 2003, "max": 2021, "step": 1},
          "description": "Choose year"
        }
      ],
      "transform": [
        {
          "calculate": "toNumber(substring(datum.date, 0, 4))",
          "as": "year"
        },
        {
          "filter": "datum.year == Choose_Year"
        },
        {
          "calculate": "min(7, ceil(toNumber(datum.forest_cover_rate_percentage) / 10))",
          "as": "nIcons"
        }
      ],
      "encoding": {
        "y": {
          "field": "name",
          "type": "nominal",
          "title": "States",
          "sort": {"field": "forest_cover_rate_percentage", "op": "mean", "order": "descending"}
        },
        "tooltip": [
          {"field": "name", "type": "nominal", "title": "State"},
          {"field": "forest_cover_rate_percentage", "type": "quantitative", "title": "Forest cover (%)"},
          {"field": "nIcons", "type": "quantitative", "title": "Number of trees (per 10%)"}
        ]
      },
      "layer": [
        {
          "transform": [{"filter": "datum.nIcons >= 1"}],
          "mark": {"type": "text", "fontSize": 26, "align": "center", "baseline": "middle"},
          "encoding": {"x": {"value": 20}, "y": {"field": "name"}, "text": {"value": "ðŸŒ³"}}
        },
        {
          "transform": [{"filter": "datum.nIcons >= 2"}],
          "mark": {"type": "text", "fontSize": 26, "align": "center", "baseline": "middle"},
          "encoding": {"x": {"value": 60}, "y": {"field": "name"}, "text": {"value": "ðŸŒ³"}}
        },
        {
          "transform": [{"filter": "datum.nIcons >= 3"}],
          "mark": {"type": "text", "fontSize": 26, "align": "center", "baseline": "middle"},
          "encoding": {"x": {"value": 100}, "y": {"field": "name"}, "text": {"value": "ðŸŒ³"}}
        },
        {
          "transform": [{"filter": "datum.nIcons >= 4"}],
          "mark": {"type": "text", "fontSize": 26, "align": "center", "baseline": "middle"},
          "encoding": {"x": {"value": 140}, "y": {"field": "name"}, "text": {"value": "ðŸŒ³"}}
        },
        {
          "transform": [{"filter": "datum.nIcons >= 5"}],
          "mark": {"type": "text", "fontSize": 26, "align": "center", "baseline": "middle"},
          "encoding": {"x": {"value": 180}, "y": {"field": "name"}, "text": {"value": "ðŸŒ³"}}
        },
        {
          "transform": [{"filter": "datum.nIcons >= 6"}],
          "mark": {"type": "text", "fontSize": 26, "align": "center", "baseline": "middle"},
          "encoding": {"x": {"value": 220}, "y": {"field": "name"}, "text": {"value": "ðŸŒ³"}}
        },
        {
          "transform": [{"filter": "datum.nIcons >= 7"}],
          "mark": {"type": "text", "fontSize": 26, "align": "center", "baseline": "middle"},
          "encoding": {"x": {"value": 260}, "y": {"field": "name"}, "text": {"value": "ðŸŒ³"}}
        }
      ],
      "width": 500,
      "height": {"step": 30},
      "title": "Malaysia Permanent Forest Coverage from 2003 to 2021",
      "config": {
        "axis": {"labelFontSize": 12, "titleFontSize": 13},
        "title": {"fontSize": 14}
      }
    };

    vegaEmbed("#viz-map", specMap, {actions: false, renderer: "canvas"}).catch(console.error);
    vegaEmbed("#viz-iso", specIso, {actions: false, renderer: "canvas"}).catch(console.error);

    const resizeMap = () => {
      const mapEl = document.querySelector("#viz-map");
      if (!mapEl) return;
      const containerWidth = mapEl.clientWidth || mapEl.parentElement.clientWidth;
      mapEl.style.maxWidth = "100%";
    };
    window.addEventListener("resize", resizeMap);
    resizeMap();
  </script>
</body>
</html>



